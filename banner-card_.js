!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("lit-element")):"function"==typeof define&&define.amd?define(["lit-element"],e):(t=t||self).BannerCard=e(t.litElement)}(this,(function(t){"use strict";var e=t.css`:host{--bc-font-size-heading:var(--banner-card-heading-size, 3em);--bc-font-size-entity-value:var(--banner-card-entity-value-size, 1.5em);--bc-font-size-media-title:var(--banner-card-media-title-size, 0.9em);--bc-spacing:var(--banner-card-spacing, 4px);--bc-button-size:var(--banner-card-button-size, 32px);--bc-heading-color-dark:var(
      --banner-card-heading-color-dark,
      var(--primary-text-color)
    );--bc-heading-color-light:var(--banner-card-heading-color-light, #fff)}ha-card{display:flex;flex-direction:column;align-items:center}paper-icon-button{width:var(--bc-button-size);height:var(--bc-button-size);padding:var(--bc-spacing)}.heading{display:block;font-size:var(--bc-font-size-heading);font-weight:300;cursor:pointer;align-self:stretch;text-align:center}.overlay-strip{background:rgba(0,0,0,.3);overflow:hidden;width:100%}.entities{padding:calc(var(--bc-spacing) * 2) 0;color:#fff;display:grid}.entity-state{display:flex;flex-direction:column;align-items:center;margin:calc(var(--bc-spacing) * 2) 0;box-shadow:-1px 0 0 0 #fff;width:100%}.media-title{flex:1 0;overflow:hidden;font-weight:300;font-size:var(--bc-font-size-media-title);white-space:nowrap;text-overflow:ellipsis}.media-controls{display:flex;flex:0 0 calc(var(--bc-button-size) * 3)}.entity-state.expand .entity-value{width:100%}.entity-state-left{margin-right:auto;margin-left:16px}.entity-state-right{margin-left:auto;margin-right:16px}.entity-name{font-weight:700;white-space:nowrap}.entity-value{display:flex;width:100%;flex:1 0;padding-top:var(--bc-spacing);font-size:var(--bc-font-size-entity-value);align-items:center;justify-content:center}.entity-value.error{display:inline-block;word-wrap:break-word;font-size:16px;width:90%}.entity-value ha-icon{color:#fff}mwc-button{--mdc-theme-primary:white}mwc-switch{--mdc-theme-secondary:white}`;function i({state:t,attributes:e},i=!1){return"string"==typeof i&&e.hasOwnProperty(i)?e[i]:t}function n(t){return"object"==typeof t?(e=t,i=t=>!1===t?null:t,Object.entries(e).reduce((t,[e,n])=>({...t,[e]:i(n,e)}),{})):{entity:t};var e,i}const a={"=":(t,e)=>e.includes(t),">":(t,e)=>t>e[0],"<":(t,e)=>t<e[0],"!=":(t,e)=>!e.includes(t)};function s(t,e){if(["string","number","boolean"].includes(typeof t))return a["="](e,[t]);if(Array.isArray(t)){const[i,...n]=t;return a.hasOwnProperty(i)?a[i](e,n):a["="](e,n)}throw new Error(`Couldn't find a valid matching strategy for '${t}'`)}const r=/^(mdi|hass):/;class o extends t.LitElement{static get properties(){return{config:Object,color:String,entities:Array,entityValues:Array,rowSize:Number,_hass:Object}}static get styles(){return[e]}constructor(){super(),this.config={},this.entities=[],this._hass={}}setConfig(t){if(void 0===t.heading)throw new Error("You need to define a heading");if(this.entities=(t.entities||[]).map(n),this.config=t,this.color=t.color||function(t,e,i){if(!t||"#"!==t[0])return i;if(3===(t=t.substring(1)).length){const[e,i,n]=t;t=[e,e,i,i,n,n].join("")}if(6!==t.length)return i;const n=[parseInt(t.slice(0,2),16)/255,parseInt(t.slice(2,4),16)/255,parseInt(t.slice(4,6),16)/255],[a,s,r]=n.map(t=>t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4));return.2126*a+.7152*s+.0722*r>.179?i:e}(t.background,"var(--bc-heading-color-light)","var(--bc-heading-color-dark)"),void 0!==t.row_size){if(t.row_size<1)throw new Error("row_size must be at least 1");this.rowSize=t.row_size}this.rowSize=this.rowSize||3}set hass(t){this._hass=t,this.entityValues=this.entities.filter(e=>(function(t,e){if(t.when){const{state:i,entity:n=t.entity,attributes:a}="string"==typeof t.when?{state:t.when}:t.when,r=e[n];return!(void 0!==i&&!s(i,r.state))&&Object.entries(a||{}).every(([t,e])=>{return s(e,r.attributes[t])})}return!0})(e,t.states)).map(t=>this.parseEntity(t))}parseEntity(t){const e=this._hass;if(!e.states.hasOwnProperty(t.entity))return{...t,error:"Entity not ready"};const n=e.states[t.entity],a=n.attributes,s={name:a.friendly_name,state:n.state,position:a.current_position,value:i(n,t.attribute),unit:a.unit_of_measurement,attributes:a,domain:t.entity.split(".")[0]},r={};if(t.map_state&&n.state in t.map_state){const e=t.map_state[n.state],i=typeof e;"string"===i?r.value=e:"object"===i&&Object.entries(e).forEach(([t,e])=>{r[t]=e})}return{...s,...t,...r}}grid(t=1){return"full"===t||t>this.rowSize?`grid-column: span ${this.rowSize};`:`grid-column: span ${t};`}_service(t,e,i){return()=>this._hass.callService(t,e,{entity_id:i})}render(){return t.html`<ha-card style=background:${this.config.background}>${this.renderHeading()} ${this.renderEntities()}</ha-card>`}renderHeading(){if(!1===this.config.heading)return null;return t.html`<h2 class=heading @click=${()=>this.config.link&&this.navigate(this.config.link)} style=color:${this.color}>${this.config.heading}</h2>`}renderEntities(){return 0===this.entityValues.length?null:t.html`<div class=overlay-strip><div class=entities style=grid-template-columns:repeat(${this.rowSize},1fr)>${this.entityValues.map(e=>{if(e.error)return t.html`<div class=entity-state style=${this.grid(e.size)}><span class=entity-name>${e.error}</span> <span class="entity-value error">${e.entity}</span></div>`;const i={...e,onClick:()=>this.openEntityPopover(e.entity)};if(e.action)return this.renderCustom({...i,action:()=>{const{service:t,...i}=e.action,[n,a]=t.split(".");this._hass.callService(n,a,{entity_id:e.entity,...i})}});if(!e.attribute)switch(e.domain){case"light":case"switch":case"input_boolean":return this.renderAsToggle(i);case"cover":return this.renderDomainCover(i);case"media_player":return this.renderDomainMediaPlayer(i)}return this.renderDomainDefault(i)})}</div></div>`}renderValue({icon:e,value:i,image:n,action:a,click:s},o){return e||function(t){return"string"==typeof t&&t.match(r)}(i)?t.html`<ha-icon .icon=${e||i} @click=${s}></ha-icon>`:!0===n?t.html`<state-badge style="background-image:url('${i}')" @click=${s}></state-badge>`:o()}renderDomainDefault({value:e,unit:i,image:n,icon:a,name:s,size:r,onClick:o}){const c=this.renderValue({icon:a,image:n,value:e,click:o},()=>t.html`${e} ${i}`);return t.html`<div class=entity-state style=${this.grid(r)} @click=${o}><span class=entity-name>${s}</span> <span class=entity-value>${c}</span></div>`}renderCustom({value:e,unit:i,action:n,image:a,icon:s,name:r,size:o,onClick:c}){const l=this.renderValue({icon:s,image:a,value:e,click:n},()=>t.html`<mwc-button ?dense=${!0} @click=${n}>${e} ${i}</mwc-button>`);return t.html`<div class=entity-state style=${this.grid(o)}><span class=entity-name @click=${c}>${r}</span> <span class=entity-value>${l}</span></div>`}renderDomainMediaPlayer({onClick:e,attributes:i,size:n,name:a,state:s,entity:r,domain:o}){const c="playing"===s,l=c?"media_pause":"media_play",d=[i.media_artist,i.media_title].join(" â€“ ");return t.html`<div class=entity-state style=${this.grid(n||"full")}><span class=entity-name @click=${e}>${a}</span><div class=entity-value><div class="entity-state-left media-title">${d}</div><div class="entity-state-right media-controls"><paper-icon-button icon=mdi:skip-previous role=button @click=${this._service(o,"media_previous_track",r)}></paper-icon-button><paper-icon-button icon=${c?"mdi:stop":"mdi:play"} role=button @click=${this._service(o,l,r)}></paper-icon-button><paper-icon-button icon=mdi:skip-next role=button @click=${this._service(o,"media_next_track",r)}></paper-icon-button></div></div></div>`}renderAsToggle({onClick:e,size:i,name:n,state:a,domain:s,entity:r}){return t.html`<div class=entity-state style=${this.grid(i)}><span class=entity-name @click=${e}>${n}</span> <span class=entity-value><mwc-switch ?checked=${"on"===a} @click=${this._service(s,"toggle",r)}></mwc-switch></span></div>`}renderDomainCover({onClick:e,size:i,name:n,state:a,entity:s}){position;return t.html`<div class=entity-state style=${this.grid(i)}><span class=entity-name @click=${e}>${n}</span> <span class=entity-value><paper-icon-button ?disabled=${"100"} icon=hass:arrow-up role=button @click=${this._service("cover","open_cover",s)}></paper-icon-button><paper-icon-button icon=hass:stop role=button @click=${this._service("cover","stop_cover",s)}></paper-icon-button><paper-icon-button ?disabled=${"0"} icon=hass:arrow-down role=button @click=${this._service("cover","close_cover",s)}></paper-icon-button></span></div>`}getCardSize(){return 3}navigate(t){history.pushState(null,"",t),this.fire("location-changed",{replace:!0})}openEntityPopover(t){this.fire("hass-more-info",{entityId:t})}fire(t,e,i){i=i||{},e=null==e?{}:e;const n=new Event(t,{bubbles:void 0===i.bubbles||i.bubbles,cancelable:Boolean(i.cancelable),composed:void 0===i.composed||i.composed});return n.detail=e,this.dispatchEvent(n),n}}return window.customElements.define("banner-card",o),o}));
